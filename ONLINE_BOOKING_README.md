# Инструкция по применению миграции для онлайн-записи

## Что было добавлено

1. **Компонент BookingWidget** (`src/components/BookingWidget.jsx`)
   - Выбор города (Москва по умолчанию)
   - Календарь с доступными датами
   - Выбор временных слотов
   - Форма контактных данных
   - Экран подтверждения бронирования

2. **Публичные API функции**:
   - `getPublicActiveSchedulePeriods()` - получение активных периодов расписания
   - `getPublicActiveSchedulePeriodsByCity()` - фильтрация по городу
   - `getPublicBookingsByCityAndDates()` - получение бронирований для проверки занятости
   - `createPublicBooking()` - создание бронирования клиентами

3. **Миграция базы данных** (`supabase/migrations/014_enable_public_booking_creation.sql`)
   - Разрешает публичным пользователям создавать слоты и бронирования

## Как применить миграцию

### Вариант 1: Через Supabase CLI (рекомендуется)
```bash
# Если у вас локальный Supabase
supabase db push

# Или если работаете с удаленной БД
supabase db push --db-url postgresql://...
```

### Вариант 2: Вручную через Supabase Dashboard
1. Откройте Supabase Dashboard
2. Перейдите в SQL Editor
3. Скопируйте содержимое файла `supabase/migrations/014_enable_public_booking_creation.sql`
4. Вставьте и выполните

## Тестирование

1. Убедитесь, что в админке созданы города и периоды расписания
2. Откройте главную страницу сайта
3. Прокрутите до секции "Онлайн-запись"
4. Проверьте:
   - Выбор города
   - Отображение доступных дат в календаре (зеленым)
   - Выбор временных слотов
   - Забронированные слоты отображаются серым
   - Заполнение формы контактов
   - Создание бронирования

## Дизайн

Виджет полностью соответствует стилю сайта:
- Темный фон с градиентами
- Ocean/slate цветовая палитра
- Плавные анимации и переходы
- Адаптивный дизайн для мобильных устройств

## Логика работы

1. **Загрузка данных**: При выборе города загружаются активные периоды расписания и существующие бронирования
2. **Генерация слотов**: Слоты генерируются динамически на фронтенде на основе периодов и бронирований
3. **Бронирование**: При создании бронирования автоматически создается слот (если его нет) и помечается как забронированный
4. **Статусы**: Слоты могут быть доступны (зеленые) или забронированы (серые)

## Безопасность

- Используется Row Level Security (RLS)
- Публичные пользователи могут только читать периоды и создавать бронирования
- Валидация на уровне базы данных предотвращает двойное бронирование
- Проверка на бронирование прошедших дат
